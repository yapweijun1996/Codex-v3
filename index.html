<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canvas Drawing Tool</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #controls { margin-bottom: 10px; }
  canvas { border: 1px solid #ccc; cursor: crosshair; }
  .toolbar button { margin-right: 5px; }
  .hidden { display: none; }
</style>
</head>
<body>
<div id="controls" class="toolbar">
  <input type="file" id="imageLoader" accept="image/*" />
  <button id="drawMode">Draw Line</button>
  <button id="textMode">Add Text</button>
  <input type="text" id="textInput" value="For Bank Use Only" class="hidden" />
  <button id="downloadBtn" class="hidden">Download</button>
</div>
<canvas id="imageCanvas"></canvas>
<script>
const canvas = document.getElementById('imageCanvas');
const ctx = canvas.getContext('2d');
let img = new Image();
let drawing = false;
let drawLineMode = false;
let addTextMode = false;
let linesDrawn = 0;
let textObj = null;
const imageLoader = document.getElementById('imageLoader');
imageLoader.addEventListener('change', handleImage, false);
function handleImage(e){
 const reader=new FileReader();
 reader.onload=function(event){
  img.onload=function(){
   canvas.width=img.width;
   canvas.height=img.height;
   ctx.drawImage(img,0,0);
   document.getElementById('downloadBtn').classList.remove('hidden');
  };
  img.src=event.target.result;
 };
 reader.readAsDataURL(e.target.files[0]);
}
const drawBtn=document.getElementById('drawMode');
drawBtn.addEventListener('click',()=>{
 drawLineMode=true;
 addTextMode=false;
 document.getElementById('textInput').classList.add('hidden');
});
const textBtn=document.getElementById('textMode');
textBtn.addEventListener('click',()=>{
 addTextMode=true;
 drawLineMode=false;
 document.getElementById('textInput').classList.remove('hidden');
});
canvas.addEventListener('mousedown',e=>{
 if(drawLineMode && linesDrawn<2){
  drawing=true;
  ctx.beginPath();
  const pos=getMousePos(e);
  ctx.moveTo(pos.x,pos.y);
 }
});
canvas.addEventListener('mousemove',e=>{
 if(drawing && drawLineMode){
  const pos=getMousePos(e);
  ctx.lineTo(pos.x,pos.y);
  ctx.stroke();
 }
});
canvas.addEventListener('mouseup',()=>{
 if(drawing && drawLineMode){
  drawing=false;
  linesDrawn++;
 }
});
canvas.addEventListener('click',e=>{
 if(addTextMode){
  const text=document.getElementById('textInput').value || 'For Bank Use Only';
  const pos=getMousePos(e);
  textObj={text:text,x:pos.x,y:pos.y};
  redrawCanvas();
  addTextMode=false;
 }else if(textObj){
  const metrics=ctx.measureText(textObj.text);
  const width=metrics.width;
  const height=parseInt(ctx.font,10)||16;
  const pos=getMousePos(e);
  if(pos.x>=textObj.x && pos.x<=textObj.x+width && pos.y-height<=textObj.y && pos.y>=textObj.y){
   canvas.style.cursor='move';
   const offsetX=pos.x-textObj.x;
   const offsetY=pos.y-textObj.y;
   const moveHandler=ev=>{
    const mPos=getMousePos(ev);
    textObj.x=mPos.x-offsetX;
    textObj.y=mPos.y-offsetY;
    redrawCanvas();
   };
   const upHandler=()=>{
    canvas.removeEventListener('mousemove',moveHandler);
    canvas.removeEventListener('mouseup',upHandler);
    canvas.style.cursor='crosshair';
   };
   canvas.addEventListener('mousemove',moveHandler);
   canvas.addEventListener('mouseup',upHandler);
  }
 }
});
function redrawCanvas(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.drawImage(img,0,0);
 if(textObj){ctx.fillText(textObj.text,textObj.x,textObj.y);}
}
function getMousePos(evt){
 const rect=canvas.getBoundingClientRect();
 return {x:evt.clientX-rect.left,y:evt.clientY-rect.top};
}
const downloadBtn=document.getElementById('downloadBtn');
downloadBtn.addEventListener('click',()=>{
 const link=document.createElement('a');
 link.download='edited-image.png';
 link.href=canvas.toDataURL();
 link.click();
});
</script>
</body>
</html>
